<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CommonMapper">
 	
 	
	<resultMap id="pointSelectMap" type="point">
		<result property="pointNo"  column="POINT_NO" 				jdbcType="INTEGER"/>
	 	<result property="pointDate" column="REG_DATE"	 		jdbcType="DATE" />
		<result property="usePoint" 	column="USE_POINT" 		jdbcType="INTEGER" />
		<result property="point" 		column="POINT" 					jdbcType="INTEGER" />
		<result property="currentPoint" 				column="CURRENT_POINT" 					jdbcType="INTEGER" />
		<result property="user.userId" 		column="USER_ID" 				jdbcType="VARCHAR"  />
		<result property="fund.fundMyPrice" 		column="FUND_MY_PRICE_NO" 				jdbcType="INTEGER"  />
		<result property="ash.ashReservationNo" 		column="ASH_RESERVATION_NO" 				jdbcType="INTEGER"  />
		<result property="purchase.purchaseNo" 		column="PURCHASE_NO" 				jdbcType="INTEGER"  />
		
	</resultMap>
	

	<select id="getTotalCount" parameterType="string" resultType="int" >
		SELECT COUNT(*)
	  	FROM(	SELECT * 
						FROM point
						where user_Id=#{value}
						ORDER BY reg_date desc) countTable					
	</select>
	
	<select id="currentPoint" parameterType="point"	resultType="int">
		select p.CURRENT_POINT from  point p,(select Max(point_no) mp from  point where USER_ID = #{user.userId}) pn where point_no=pn.mp  group by CURRENT_POINT
	</select>
	
	<select id="myPointList" parameterType="map"	resultMap="pointSelectMap">
		select REG_DATE,CURRENT_POINT,FUND_MY_PRICE_NO,ASH_RESERVATION_NO,PURCHASE_NO,USE_POINT,POINT
		from  (SELECT if.REG_DATE,if.CURRENT_POINT,if.FUND_MY_PRICE_NO,if.ASH_RESERVATION_NO,if.PURCHASE_NO,if.USE_POINT,POINT,ROWNUM AS row_seq 
					FROM( SELECT REG_DATE,CURRENT_POINT,FUND_MY_PRICE_NO,ASH_RESERVATION_NO,PURCHASE_NO,USE_POINT,POINT
									FROM point 
									where 
									USER_ID=#{userId}
									ORDER BY reg_date) if
						WHERE ROWNUM &lt;= #{search.endRowNum} )
		 where row_seq BETWEEN #{search.startRowNum} AND #{search.endRowNum}
	 </select>
	
	
	<!-- SQL : INSERT -->
	<insert id="addPointUse"	parameterType="point" >
	 	INSERT
		 INTO point VALUES (seq_point_no.nextval,#{user.userId},
		 <if test="fund.fundMyPriceNo != null">#{fund.fundMyPriceNo}</if>
		 ,0,0,SYSDATE,#{usePoint},0,#{currentPoint})
		 
												
	 </insert>
	 
	 <insert id="addPointSave"	parameterType="point" >
	 	INSERT
		 INTO point VALUES (seq_point_no.nextval,#{user.userId},
		 <if test="fund.fundTitle!=null">#{fund.fundMyPriceNo}</if>
		 ,0,0,SYSDATE,0,#{point},#{currentPoint})
		 										
	 </insert>
	
	
	
	
	<!-- <insert id="addPointUse"	parameterType="point" >
	 	INSERT
		 INTO point VALUES (seq_point_no.nextval,#{user.userId},
		 <if test="fund.fundTitle != null">seq_fund_fund_no.nextval</if>
		 <if test="ash.ashReservationName != null">seq_ash_ash_no.nextval</if>
		 <if test="purchase.product.prodName != null">seq_purchase_purchase_no.nextval</if> 
		 ,0,0,SYSDATE,#{usePoint},0,#{currentPoint})
		 
												
	 </insert>
	 
	 <insert id="addPointSave"	parameterType="point" >
	 	INSERT
		 INTO point VALUES (seq_point_no.nextval,#{user.userId},
		 <if test="fund.fundTitle!=null">seq_fund_fund_no.nextval</if>
		 <if test="ash.ashReservationName!=null">seq_ash_ash_no.nextval</if>
		 <if test="purchase.product.prodName !=null">seq_purchase_purchase_no.nextval</if>
		 ,0,0,SYSDATE,0,#{point},#{currentPoint})
		 										
	 </insert> -->
	 
	

	 
</mapper>